<div class="create-need-container">
  <div class="content-wrapper">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title gradient-text">Créer un Besoin (CPS)</h1>
      <p class="page-subtitle">Veuillez remplir les informations pour créer un nouveau besoin.</p>
    </div>

    <!-- Success Alert -->
    <div *ngIf="showSuccess" class="alert alert-success">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <span>Besoin créé avec succès !</span>
    </div>

    <!-- Error Alert -->
    <div *ngIf="showError" class="alert alert-error">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span>{{ errorMessage }}</span>
    </div>

    <!-- Form Card -->
    <div class="form-card">
      <div [formGroup]="createNeedForm">
        
        <!-- Titre du besoin -->
        <div class="form-group">
          <label class="form-label">
            Titre du besoin <span class="required">*</span>
          </label>
          <input 
            type="text" 
            class="form-input"
            [class.error]="isFieldInvalid('titre')"
            formControlName="titre"
            placeholder="Entrez le titre du besoin"
          />
          <div *ngIf="isFieldInvalid('titre')" class="error-text">
            <ng-container *ngIf="createNeedForm.get('titre')?.errors?.['required']">
              Le titre est obligatoire
            </ng-container>
            <ng-container *ngIf="createNeedForm.get('titre')?.errors?.['minlength']">
              Le titre doit contenir au moins 3 caractères
            </ng-container>
          </div>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label class="form-label">
            Description <span class="required">*</span>
          </label>
          <textarea 
            class="form-input form-textarea"
            [class.error]="isFieldInvalid('description')"
            formControlName="description"
            placeholder="Décrivez le besoin…"
            rows="6"
          ></textarea>
          <div *ngIf="isFieldInvalid('description')" class="error-text">
            <ng-container *ngIf="createNeedForm.get('description')?.errors?.['required']">
              La description est obligatoire
            </ng-container>
            <ng-container *ngIf="createNeedForm.get('description')?.errors?.['minlength']">
              La description doit contenir au moins 10 caractères
            </ng-container>
          </div>
        </div>

        <!-- Fichier CPS -->
        <div class="form-group">
          <label class="form-label">
            Fichier CPS (.txt) <span class="required">*</span>
          </label>
          <div class="file-upload-wrapper">
            <input 
              type="file" 
              #fileInput
              class="file-upload-input"
              accept=".txt"
              (change)="onFileSelected($event)"
            />
            <div 
              class="file-upload-label"
              [class.has-file]="selectedFileName"
              (click)="fileInput.click()"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <span>{{ selectedFileName || 'Importer le fichier CPS (.txt)' }}</span>
            </div>
          </div>
          <div *ngIf="fileError" class="error-text">
            {{ fileError }}
          </div>
          <div *ngIf="isFieldInvalid('fichierCPS')" class="error-text">
            Le fichier CPS est obligatoire
          </div>
        </div>

        <!-- Date de création -->
        <div class="form-group">
          <label class="form-label">Date de création</label>
          <input 
            type="text" 
            class="form-input form-input-disabled"
            [value]="currentDate"
            disabled
          />
        </div>

        <!-- Submit Button -->
        <button 
          type="button"
          class="submit-btn"
          [disabled]="isLoading"
          (click)="onSubmit()"
        >
          <svg 
            *ngIf="isLoading" 
            class="spinner"
            width="20" 
            height="20" 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="2"
          >
            <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
          </svg>
          <span>{{ isLoading ? 'Création en cours...' : 'Créer le Besoin' }}</span>
        </button>

      </div>
    </div>
  </div>
</div>