<header class="app-header" [class.scrolled]="isScrolled">
  <div class="header-container">
    
    <!-- Left Section: Branding -->
    <div class="header-left">
      <div class="logo-container" [routerLink]="['/dashboard']">
        <div class="logo-icon">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="16" cy="16" r="14" fill="url(#logo-gradient)" stroke="white" stroke-width="2"/>
            <path d="M16 8L20 12L16 16L12 12L16 8Z" fill="white"/>
            <path d="M16 16L20 20L16 24L12 20L16 16Z" fill="white" opacity="0.8"/>
            <defs>
              <linearGradient id="logo-gradient" x1="0" y1="0" x2="32" y2="32">
                <stop offset="0%" stop-color="#42A5F5"/>
                <stop offset="100%" stop-color="#1565C0"/>
              </linearGradient>
            </defs>
          </svg>
        </div>
        <span class="app-title">Système de Suivi des Marchés</span>
      </div>
    </div>

    <!-- Center Section: Page Title -->
    <div class="header-center">
      <h1 class="page-title" @fadeIn>{{ pageTitle }}</h1>
    </div>

    <!-- Right Section: User Actions -->
    <div class="header-right">
      
      <!-- Desktop Actions -->
      <div class="desktop-actions">
        
        <!-- Theme Toggle -->
        <button class="icon-button theme-toggle" (click)="toggleTheme()" title="Changer le thème">
          <svg *ngIf="!isDarkMode" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <svg *ngIf="isDarkMode" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>

        <!-- Notifications -->
        <button class="icon-button notification-button" (click)="onNotificationClick()" title="Notifications">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          <span *ngIf="notificationCount > 0" class="notification-badge">{{ notificationCount }}</span>
        </button>

        <!-- User Profile -->
        <div class="user-profile" (click)="onProfileClick()">
          <div class="user-avatar">
            <img *ngIf="userInfo.avatar" [src]="userInfo.avatar" [alt]="userInfo.name">
            <span *ngIf="!userInfo.avatar" class="avatar-initials">{{ getUserInitials() }}</span>
          </div>
          <div class="user-info">
            <span class="user-name">{{ userInfo.name }}</span>
            <span class="user-role">{{ getRoleDisplay() }}</span>
          </div>
          <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </div>

        <!-- Dropdown Menu -->
        <div *ngIf="isDropdownOpen" class="dropdown-menu" @dropdownAnimation>
          <button class="dropdown-item" (click)="goToProfile()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <span>Mon Profil</span>
          </button>
          <button class="dropdown-item" (click)="changePassword()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            <span>Changer le mot de passe</span>
          </button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item logout" (click)="logout()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            <span>Se déconnecter</span>
          </button>
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <button class="mobile-menu-button" (click)="toggleMobileMenu()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
    </div>

  </div>

  <!-- Mobile Menu Overlay -->
  <div *ngIf="isMobileMenuOpen" class="mobile-menu" @dropdownAnimation>
    <div class="mobile-menu-header">
      <div class="user-avatar large">
        <img *ngIf="userInfo.avatar" [src]="userInfo.avatar" [alt]="userInfo.name">
        <span *ngIf="!userInfo.avatar" class="avatar-initials">{{ getUserInitials() }}</span>
      </div>
      <div class="user-info-mobile">
        <span class="user-name">{{ userInfo.name }}</span>
        <span class="user-role">{{ getRoleDisplay() }}</span>
      </div>
    </div>
    <div class="mobile-menu-actions">
      <button class="mobile-menu-item" (click)="onNotificationClick()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
        <span>Notifications</span>
        <span *ngIf="notificationCount > 0" class="notification-badge">{{ notificationCount }}</span>
      </button>
      <button class="mobile-menu-item" (click)="goToProfile()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        <span>Mon Profil</span>
      </button>
      <button class="mobile-menu-item" (click)="changePassword()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
        <span>Changer le mot de passe</span>
      </button>
      <button class="mobile-menu-item" (click)="toggleTheme()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
        </svg>
        <span>{{ isDarkMode ? 'Mode clair' : 'Mode sombre' }}</span>
      </button>
      <div class="mobile-menu-divider"></div>
      <button class="mobile-menu-item logout" (click)="logout()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        <span>Se déconnecter</span>
      </button>
    </div>
  </div>
</header>